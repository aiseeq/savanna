package simulation

// game_balance.go содержит все константы игрового баланса
// Устраняет магические числа и обеспечивает единую точку настройки игровых параметров

// === БАЗОВЫЕ РАЗМЕРЫ ЖИВОТНЫХ ===
// Это единственные "магические" константы в проекте - все остальные выводятся от них
// КРИТИЧЕСКИ ВАЖНО: ВСЕ РАЗМЕРЫ В ТАЙЛАХ (физическая ширина тайла = 1.0)

const (
	// Базовые радиусы животных (в ТАЙЛАХ - будут конвертированы в пиксели для Size компонента)
	// ИСПРАВЛЕНО: Разумные размеры для геймплея без блокирующих коллизий
	// Заяц: радиус 0.25 тайла, видение 3.0 тайла, скорость 0.6 тайла/сек
	// Волк: радиус 0.35 тайла, видение ≈5.0 тайлов, атака 0.9 тайла, скорость 1.0 тайл/сек
	RabbitBaseRadius = 0.25 // Заяц - радиус 0.25 тайла → 8 пикселей после конвертации (четверть тайла)
	WolfBaseRadius   = 0.35 // Волк - радиус 0.35 тайла → 11 пикселей после конвертации (треть тайла)

	// Универсальные множители для неизвестных типов животных
	DefaultAnimalRadius = 0.03 // Средний размер в тайлах (уменьшен в 10 раз)
	DefaultAnimalSpeed  = 0.1  // Разумная скорость в тайлах/сек (уменьшена в 20 раз)
	DefaultAnimalHealth = 50   // Хиты остаются в абсолютных единицах

	// Специальные значения Target в EatingState
	GrassEatingTarget = 0 // Target = 0 означает поедание травы (не сущности)
)

// === РАЗМЕРНЫЕ МНОЖИТЕЛИ ===
// Все размеры выводятся от базового радиуса через явные множители

const (
	// Множители радиусов
	CollisionRadiusMultiplier = 1.0 // Радиус коллизий = базовый радиус

	// Множители дальности видения (размер влияет на обзор)
	// ИСПРАВЛЕНО: Скорректированы для новых размеров животных
	RabbitVisionMultiplier  = 12.0 // Заяц видит на 3 тайла (0.25 * 12 = 3.0)
	WolfVisionMultiplier    = 14.3 // Волк видит на 5 тайлов (0.35 * 14.3 ≈ 5.0)
	DefaultVisionMultiplier = 16.0 // Умеренная дальность видения (0.03 * 16 ≈ 0.5 тайла)

	// Множители дальности атаки (только для хищников)
	WolfAttackRangeMultiplier = 7.0 // Атака на 2.45 тайла (0.35 * 7.0 = 2.45) - больше дистанции бегства зайца

	// Множители дальности побега (травоядные убегают от хищников)
	// ИСПРАВЛЕНИЕ: Зайцы убегают при виде волка с разумного расстояния
	RabbitFleeDistanceMultiplier = 8.0 // Заяц убегает на расстоянии 2 тайла (0.25 * 8 = 2.0)
)

// === ХАРАКТЕРИСТИКИ ЗДОРОВЬЯ ===

const (
	// Здоровье животных (соотносится с размером и ролью)
	RabbitMaxHealth = 50  // Хрупкое травоядное
	WolfMaxHealth   = 100 // Выносливый хищник

	// Урон и боевые характеристики
	WolfAttackDamageDefault = 35  // Урон атаки волка (по умолчанию)
	WolfAttackCooldown      = 0.1 // Секунды между атаками - ИСПРАВЛЕНО: очень частые атаки для активной экосистемы
	WolfHitChance           = 1.0 // 100% шанс попадания (повышено с 0.9 для стабильности тестов)

	// Пацифистские животные не атакуют
	PacifistAttackDamage   = 0
	PacifistAttackCooldown = 0.0
	PacifistHitChance      = 0.0
)

// === СКОРОСТНЫЕ ХАРАКТЕРИСТИКИ ===

const (
	// Базовые скорости животных (ТАЙЛЫ/секунда)
	// ФИНАЛЬНЫЕ ЗНАЧЕНИЯ согласно плану стабилизации:
	// ИСПРАВЛЕНО: Увеличены скорости в 1.7 раза для более динамичного геймплея
	RabbitBaseSpeed = 1.0 // Заяц: 1.0 тайл/сек - увеличена с 0.6
	WolfBaseSpeed   = 1.7 // Волк: 1.7 тайл/сек - увеличена с 1.0

	// Множители скорости в разных состояниях поведения
	SearchSpeedMultiplier    = 0.8 // Поиск еды/добычи
	WanderingSpeedMultiplier = 0.7 // Случайное блуждание
	ContentSpeedMultiplier   = 0.3 // Спокойное состояние
	HuntingSpeedMultiplier   = 1.0 // Активная охота (полная скорость)
)

// === ПОРОГИ СЫТОСТИ ===

const (
	// Пороги начала поиска еды (% от максимальной сытости)
	// ИСПРАВЛЕНО: снижены пороги для реалистичного баланса
	RabbitSatiationThreshold  = 60.0 // Заяц начинает искать еду при 60% сытости
	WolfSatiationThreshold    = 50.0 // Волк охотится при 50% сытости
	DefaultSatiationThreshold = 55.0 // Умеренный аппетит

	// Максимальное значение сытости для всех животных
	MaxSatiationLimit = 100.0

	// Начальная сытость новых животных (% сытости при создании)
	RabbitInitialSatiation  = 80.0 // Зайцы создаются довольно сытыми
	WolfInitialSatiation    = 70.0 // Волки создаются умеренно голодными
	DefaultInitialSatiation = 75.0 // Умеренная начальная сытость

	// ПРИМЕЧАНИЕ: SatietyTolerance перенесена в constants.go для устранения дублирования
)

// === ТАЙМЕРЫ ПОВЕДЕНИЯ ===

const (
	// Интервалы смены направления движения (секунды)
	RabbitMinDirectionTime = 1.0 // Заяц быстро меняет направление
	RabbitMaxDirectionTime = 4.0

	WolfMinDirectionTime = 2.0 // Волк движется более целенаправленно
	WolfMaxDirectionTime = 6.0

	DefaultMinDirectionTime = 1.0 // Умеренная частота смены направления
	DefaultMaxDirectionTime = 4.0
)

// === ФИЗИЧЕСКИЕ КОНСТАНТЫ СИМУЛЯЦИИ ===

const (
	// Скорость уменьшения сытости
	// ИСПРАВЛЕНО: увеличена скорость потери сытости
	BaseSatiationDecreaseRate = 5.0 // Процентов в секунду

	// Урон здоровью при голодании
	BaseHealthDamageRate      = 1.0 // Хитов в секунду при сытости = 0
	StarvationDamagePerSecond = 1.0 // Алиас для новой системы StarvationDamageSystem

	// Константы поедания травы
	GrassPerEatingTick   = 1.0  // Трава съедаемая за кадр анимации (возвращено к оригиналу)
	GrassNutritionValue  = 2.0  // Сколько сытости дает 1 единица травы (возвращено к оригиналу)
	MinGrassAmountToFind = 10.0 // Минимальное количество травы для поедания

	// Прогресс поедания (для расчета процента завершения)
	GrassEatingProgressDivisor = 10.0 // Делитель для прогресса (10 единиц травы = 100% прогресса)

	// Константы поедания мяса (хищники)
	CorpseNutritionPerTick = 1.0 // Питательность съедаемая за кадр анимации - ИСПРАВЛЕНО: 50 кадров для полного поедания
	// ПРИМЕЧАНИЕ: NutritionToHungerRatio перенесена в constants.go для устранения дублирования
	EatingRange = 0.5 // Дистанция для поедания трупов (в тайлах)

	// Прогресс поедания (для UI)
	EatingProgressDivisor = 10.0 // Делитель для расчета прогресса (0-1)
)

// === ВЛИЯНИЕ СЫТОСТИ И ЗДОРОВЬЯ НА СКОРОСТЬ ===

const (
	// НОВАЯ ЛОГИКА СКОРОСТИ (по требованию пользователя):
	// 1. Малосытные (< 80%) бегают с полной скоростью
	// 2. Сытые (> 80%) замедляются: скорость *= (1 + 0.8 - сытость)
	// 3. Раненые: скорость *= (процент_здоровья / 100)

	SatiatedThreshold             = 80.0 // При сытости > 80% животные замедляются
	CriticalHealthThreshold       = 20.0 // При здоровье < 20% критическое замедление
	LowHealthThreshold            = 50.0 // При здоровье < 50% умеренное замедление
	CriticalHealthSpeedMultiplier = 0.5  // Критично раненые животные
	LowHealthSpeedMultiplier      = 0.8  // Раненые животные

	// Константы для расчета скорости сытых животных (устраняет магические числа в feeding.go)
	PercentToRatioConversion = 100.0 // Переводим проценты в доли (90% → 0.9)
	SatietySlowdownOffset    = 0.8   // Формула замедления сытых животных: 1.0 + 0.8 - satietyRatio
	NormalSpeedMultiplier    = 1.0   // Нормальная скорость (множитель)
	MinimumSpeedMultiplier   = 0.1   // Минимальная скорость для безопасности

)

// === СЛУЧАЙНОЕ ДВИЖЕНИЕ ===

const (
	// Параметры случайного блуждания
	RandomWalkTimeMin        = 2.0 // Минимальное время движения в одном направлении
	RandomWalkTimeMax        = 5.0 // Максимальное время движения в одном направлении
	RandomSpeedMinMultiplier = 0.5 // Минимальный множитель скорости
	RandomSpeedMaxMultiplier = 1.0 // Максимальный множитель скорости
)

// === СИСТЕМНЫЕ ПАРАМЕТРЫ ===

const (
	// Параметры для FeedingSystem
	LargeAnimalSizeThreshold = 0.4 // Порог радиуса для "крупного" животного (в тайлах)
	LargeAnimalSaitationRate = 0.5 // Крупные животные теряют сытость в 2 раза медленнее
)

// === БОЕВЫЕ КОНСТАНТЫ ===

const (
	// Таймеры фаз атаки (устраняет магические числа в attack_system.go)
	AttackWindupDuration = 0.08 // Длительность замаха (секунды)
	AttackStrikeDuration = 0.2  // Длительность удара (секунды)

	// Интенсивность визуальных эффектов
	MaxDamageFlashIntensity = 1.0 // Максимальная интенсивность мигания при уроне
)

// === ГЕЙМПЛЕЙНЫЕ КОНСТАНТЫ ===

const (
	// Fallback порог сытости для неизвестных животных
	FallbackSatiationThreshold = 75.0

	// Множитель расстояния для проверки близости к траве
	GrassProximityMultiplier = 1.5 // Животное должно быть в 1.5x радиуса от травы

	// Большое число для поиска минимального расстояния
	LargeDistanceValue = 1e9
)

// === СИСТЕМА КОЛЛИЗИЙ И РАСТАЛКИВАНИЯ ===
// Настройки физического и поведенческого избегания столкновений

const (
	// Физическая система коллизий (movement.go)
	// Радиус поиска соседей для системы коллизий
	CollisionSearchRadiusMultiplier = 2.0 // Ищем соседей в радиусе в 2x больше размера объекта

	// Сила расталкивания при прямом столкновении (ДОПОЛНИТЕЛЬНО СМЯГЧЕНО)
	CollisionSeparationForceMultiplier = 1.0 // Коэффициент силы разделения позиций (смягчили с 1.2 до 1.0)

	// Мягкое расталкивание при близости (ДОПОЛНИТЕЛЬНО СМЯГЧЕНО)
	SoftCollisionPushForce = 1.5 // Базовая сила мягкого расталкивания (смягчили с 2.0 до 1.5)

	// Жёсткое расталкивание при пересечении (ДОПОЛНИТЕЛЬНО СМЯГЧЕНО)
	HardCollisionPenetrationThreshold = 0.05 // Порог проникновения для жёсткого расталкивания (тайлы)
	HardCollisionPushForceMultiplier  = 10.0 // Множитель силы жёсткого расталкивания (смягчили с 15.0 до 10.0)

	// Поведенческая система избегания (behavior_strategies.go)
	// Радиус поиска соседей для избегания в поведении
	BehaviorAvoidanceRadiusMultiplier = 1.5 // Избегание в радиусе в 1.5x больше радиуса коллизий

	// Максимальная сила поведенческого избегания (ДОПОЛНИТЕЛЬНО СМЯГЧЕНО)
	BehaviorAvoidanceMaxStrength = 0.2 // 20% от основного направления к траве (смягчили с 25% до 20%)

	// Дистанция безопасности для предварительного расталкивания
	SafeDistanceBufferInTiles = 0.1 // Буферная дистанция в тайлах для предотвращения слипания
)
